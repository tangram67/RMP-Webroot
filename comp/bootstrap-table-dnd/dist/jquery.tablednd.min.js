!function(d,c,a,f){var b="touchstart mousedown",e="touchmove mousemove",g="touchend mouseup";d(a).ready(function(){function h(j){var i={},k=j.match(/([^;:]+)/g)||[];
while(k.length){i[k.shift()]=k.shift().trim()}return i}d("table").each(function(){if(d(this).data("table")==="dnd"){d(this).tableDnD({onDragStyle:d(this).data("ondragstyle")&&h(d(this).data("ondragstyle"))||null,onDropStyle:d(this).data("ondropstyle")&&h(d(this).data("ondropstyle"))||null,onDragClass:d(this).data("ondragclass")===f&&"tDnD_whileDrag"||d(this).data("ondragclass"),onDrop:d(this).data("ondrop")&&new Function("table","row",d(this).data("ondrop")),onDragStart:d(this).data("ondragstart")&&new Function("table","row",d(this).data("ondragstart")),onDragStop:d(this).data("ondragstop")&&new Function("table","row",d(this).data("ondragstop")),scrollAmount:d(this).data("scrollamount")||5,sensitivity:d(this).data("sensitivity")||10,hierarchyLevel:d(this).data("hierarchylevel")||0,indentArtifact:d(this).data("indentartifact")||'<div class="indent">&nbsp;</div>',autoWidthAdjust:d(this).data("autowidthadjust")||true,autoCleanRelations:d(this).data("autocleanrelations")||true,jsonPretifySeparator:d(this).data("jsonpretifyseparator")||"\t",serializeRegexp:d(this).data("serializeregexp")&&new RegExp(d(this).data("serializeregexp"))||/[^\-]*$/,serializeParamName:d(this).data("serializeparamname")||false,dragHandle:d(this).data("draghandle")||null})
}})});jQuery.tableDnD={currentTable:null,dragObject:null,mouseOffset:null,oldX:0,oldY:0,build:function(h){this.each(function(){this.tableDnDConfig=d.extend({onDragStyle:null,onDropStyle:null,onDragClass:"tDnD_whileDrag",onDrop:null,onDragStart:null,onDragStop:null,scrollAmount:5,sensitivity:10,hierarchyLevel:0,indentArtifact:'<div class="indent">&nbsp;</div>',autoWidthAdjust:true,autoCleanRelations:true,jsonPretifySeparator:"\t",serializeRegexp:/[^\-]*$/,serializeParamName:false,dragHandle:null},h||{});
d.tableDnD.makeDraggable(this);this.tableDnDConfig.hierarchyLevel&&d.tableDnD.makeIndented(this)});return this},makeIndented:function(o){var h=o.tableDnDConfig,p=o.rows,l=d(p).first().find("td:first")[0],n=0,i=0,k,j;
if(d(o).hasClass("indtd")){return null}j=d(o).addClass("indtd").attr("style");d(o).css({whiteSpace:"nowrap"});for(var m=0;
m<p.length;m++){if(i<d(p[m]).find("td:first").text().length){i=d(p[m]).find("td:first").text().length;k=m}}d(l).css({width:"auto"});
for(m=0;m<h.hierarchyLevel;m++){d(p[k]).find("td:first").prepend(h.indentArtifact)}l&&d(l).css({width:l.offsetWidth});j&&d(o).css(j);
for(m=0;m<h.hierarchyLevel;m++){d(p[k]).find("td:first").children(":first").remove()}h.hierarchyLevel&&d(p).each(function(){n=d(this).data("level")||0;
n<=h.hierarchyLevel&&d(this).data("level",n)||d(this).data("level",0);for(var q=0;q<d(this).data("level");q++){d(this).find("td:first").prepend(h.indentArtifact)
}});return this},makeDraggable:function(i){var h=i.tableDnDConfig;h.dragHandle&&d(h.dragHandle,i).each(function(){d(this).bind(b,function(j){d.tableDnD.initialiseDrag(d(this).parents("tr")[0],i,this,j,h);
return false})})||d(i.rows).each(function(){if(!d(this).hasClass("nodrag")){d(this).bind(b,function(j){if(j.target.tagName==="TD"){d.tableDnD.initialiseDrag(this,i,this,j,h);
return false}}).css("cursor","move")}else{d(this).css("cursor","")}})},currentOrder:function(){var h=this.currentTable.rows;
return d.map(h,function(i){return(d(i).data("level")+i.id).replace(/\s/g,"")}).join("")},initialiseDrag:function(j,i,l,k,h){this.dragObject=j;
this.currentTable=i;this.mouseOffset=this.getMouseOffset(l,k);this.originalOrder=this.currentOrder();d(a).bind(e,this.mousemove).bind(g,this.mouseup);
h.onDragStart&&h.onDragStart(i,l)},updateTables:function(){this.each(function(){if(this.tableDnDConfig){d.tableDnD.makeDraggable(this)
}})},mouseCoords:function(h){if(h.originalEvent.changedTouches){return{x:h.originalEvent.changedTouches[0].clientX,y:h.originalEvent.changedTouches[0].clientY}
}if(h.pageX||h.pageY){return{x:h.pageX,y:h.pageY}}return{x:h.clientX+a.body.scrollLeft-a.body.clientLeft,y:h.clientY+a.body.scrollTop-a.body.clientTop}
},getMouseOffset:function(k,j){var h,i;j=j||c.event;i=this.getPosition(k);h=this.mouseCoords(j);return{x:h.x-i.x,y:h.y-i.y}
},getPosition:function(h){var j=0,i=0;if(h.offsetHeight===0){h=h.firstChild}while(h.offsetParent){j+=h.offsetLeft;i+=h.offsetTop;
h=h.offsetParent}j+=h.offsetLeft;i+=h.offsetTop;return{x:j,y:i}},autoScroll:function(h){var i=this.currentTable.tableDnDConfig,j=c.pageYOffset,k=c.innerHeight?c.innerHeight:a.documentElement.clientHeight?a.documentElement.clientHeight:a.body.clientHeight;
if(a.all){if(typeof a.compatMode!=="undefined"&&a.compatMode!=="BackCompat"){j=a.documentElement.scrollTop}else{if(typeof a.body!=="undefined"){j=a.body.scrollTop
}}}h.y-j<i.scrollAmount&&c.scrollBy(0,-i.scrollAmount)||k-(h.y-j)<i.scrollAmount&&c.scrollBy(0,i.scrollAmount)},moveVerticle:function(h,i){if(0!==h.vertical&&i&&this.dragObject!==i&&this.dragObject.parentNode===i.parentNode){0>h.vertical&&this.dragObject.parentNode.insertBefore(this.dragObject,i.nextSibling)||0<h.vertical&&this.dragObject.parentNode.insertBefore(this.dragObject,i)
}},moveHorizontal:function(h,j){var i=this.currentTable.tableDnDConfig,k;if(!i.hierarchyLevel||0===h.horizontal||!j||this.dragObject!==j){return null
}k=d(j).data("level");0<h.horizontal&&k>0&&d(j).find("td:first").children(":first").remove()&&d(j).data("level",--k);0>h.horizontal&&k<i.hierarchyLevel&&d(j).prev().data("level")>=k&&d(j).children(":first").prepend(i.indentArtifact)&&d(j).data("level",++k)
},mousemove:function(l){var k=d(d.tableDnD.dragObject),j=d.tableDnD.currentTable.tableDnDConfig,o,p,h,n,m;l&&l.preventDefault();
if(!d.tableDnD.dragObject){return false}var i=false;if(l.type==="touchmove"){i=true;event.preventDefault()}j.onDragClass&&k.addClass(j.onDragClass)||k.css(j.onDragStyle);
p=d.tableDnD.mouseCoords(l);n=p.x-d.tableDnD.mouseOffset.x;m=p.y-d.tableDnD.mouseOffset.y;if(!i){d.tableDnD.autoScroll(p)
}o=d.tableDnD.findDropTargetRow(k,m);h=d.tableDnD.findDragDirection(n,m);d.tableDnD.moveVerticle(h,o);d.tableDnD.moveHorizontal(h,o);
return false},findDragDirection:function(n,m){var k=this.currentTable.tableDnDConfig.sensitivity,q=this.oldX,o=this.oldY,i=q-k,l=q+k,p=o-k,j=o+k,h={horizontal:n>=i&&n<=l?0:n>q?-1:1,vertical:m>=p&&m<=j?0:m>o?-1:1};
if(h.horizontal!==0){this.oldX=n}if(h.vertical!==0){this.oldY=m}return h},findDropTargetRow:function(m,p){var l=0,n=this.currentTable.rows,j=this.currentTable.tableDnDConfig,h=0,o=null;
for(var k=0;k<n.length;k++){o=n[k];h=this.getPosition(o).y;l=parseInt(o.offsetHeight)/2;if(o.offsetHeight===0){h=this.getPosition(o.firstChild).y;
l=parseInt(o.firstChild.offsetHeight)/2}if(p>(h-l)&&p<(h+l)){if(m.is(o)||(j.onAllowDrop&&!j.onAllowDrop(m,o))||d(o).hasClass("nodrop")){return null
}else{return o}}}return null},processMouseup:function(){if(!this.currentTable||!this.dragObject){return null}var h=this.currentTable.tableDnDConfig,i=this.dragObject,k=0,j=0;
d(a).unbind(e,this.mousemove).unbind(g,this.mouseup);h.hierarchyLevel&&h.autoCleanRelations&&d(this.currentTable.rows).first().find("td:first").children().each(function(){j=d(this).parents("tr:first").data("level");
j&&d(this).parents("tr:first").data("level",--j)&&d(this).remove()})&&h.hierarchyLevel>1&&d(this.currentTable.rows).each(function(){j=d(this).data("level");
if(j>1){k=d(this).prev().data("level");while(j>k+1){d(this).find("td:first").children(":first").remove();d(this).data("level",--j)
}}});h.onDragClass&&d(i).removeClass(h.onDragClass)||d(i).css(h.onDropStyle);this.dragObject=null;h.onDrop&&this.originalOrder!==this.currentOrder()&&d(i).hide().fadeIn("fast")&&h.onDrop(this.currentTable,i);
h.onDragStop&&h.onDragStop(this.currentTable,i);this.currentTable=null},mouseup:function(h){h&&h.preventDefault();d.tableDnD.processMouseup();
return false},jsonize:function(h){var i=this.currentTable;if(h){return JSON.stringify(this.tableData(i),null,i.tableDnDConfig.jsonPretifySeparator)
}return JSON.stringify(this.tableData(i))},serialize:function(){return d.param(this.tableData(this.currentTable))},serializeTable:function(k){var h="";
var n=k.tableDnDConfig.serializeParamName||k.id;var l=k.rows;for(var j=0;j<l.length;j++){if(h.length>0){h+="&"}var m=l[j].id;
if(m&&k.tableDnDConfig&&k.tableDnDConfig.serializeRegexp){m=m.match(k.tableDnDConfig.serializeRegexp)[0];h+=n+"[]="+m}}return h
},serializeTables:function(){var h=[];d("table").each(function(){this.id&&h.push(d.param(d.tableDnD.tableData(this)))});return h.join("&")
},tableData:function(u){var n=u.tableDnDConfig,k=[],l=0,t=0,s=null,p={},m,r,j,v;if(!u){u=this.currentTable}if(!u||!u.rows||!u.rows.length){return{error:{code:500,message:"Not a valid table."}}
}if(!u.id&&!n.serializeParamName){return{error:{code:500,message:"No serializable unique id provided."}}}v=n.autoCleanRelations&&u.rows||d.makeArray(u.rows);
r=n.serializeParamName||u.id;j=r;m=function(h){if(h&&n&&n.serializeRegexp){return h.match(n.serializeRegexp)[0]}return h};
p[j]=[];!n.autoCleanRelations&&d(v[0]).data("level")&&v.unshift({id:"undefined"});for(var o=0;o<v.length;o++){if(n.hierarchyLevel){t=d(v[o]).data("level")||0;
if(t===0){j=r;k=[]}else{if(t>l){k.push([j,l]);j=m(v[o-1].id)}else{if(t<l){for(var q=0;q<k.length;q++){if(k[q][1]===t){j=k[q][0]
}if(k[q][1]>=l){k[q][1]=0}}}}}l=t;if(!d.isArray(p[j])){p[j]=[]}s=m(v[o].id);s&&p[j].push(s)}else{s=m(v[o].id);s&&p[j].push(s)
}}return p}};jQuery.fn.extend({tableDnD:d.tableDnD.build,tableDnDUpdate:d.tableDnD.updateTables,tableDnDSerialize:d.proxy(d.tableDnD.serialize,d.tableDnD),tableDnDSerializeAll:d.tableDnD.serializeTables,tableDnDData:d.proxy(d.tableDnD.tableData,d.tableDnD)})
}(jQuery,window,window.document);